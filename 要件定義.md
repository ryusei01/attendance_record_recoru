# 勤怠記録自動入力アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的

画像形式の勤怠表や Excel ファイルから勤怠情報を読み取り、レコル（https://app.recoru.in/ap/home/）に自動入力するアプリケーションを開発する。

### 1.2 背景

- 手動での勤怠入力作業を自動化し、作業効率を向上させる
- 画像や Excel ファイルから勤怠データを抽出し、システムに入力する作業を簡素化する

## 2. 機能要件

### 2.1 入力機能

- **画像ファイル読み取り**

  - 対応形式：JPEG、PNG、PDF
  - 勤怠表の画像から日付、出勤時刻、退勤時刻、休憩時間などを抽出
  - 手書き・印刷の両方に対応（可能な範囲で）

- **Excel ファイル読み取り**
  - 対応形式：.xlsx、.xls
  - 勤怠データの列を自動認識
  - 日付、出勤時刻、退勤時刻、休憩時間などの項目を抽出

### 2.2 データ処理機能

- **データ抽出**

  - OCR（光学文字認識）を使用した画像からのテキスト抽出
  - Excel ファイルからの構造化データ抽出
  - 日付形式の正規化（YYYY-MM-DD 形式など）
  - 時刻形式の正規化（HH:MM 形式など）

- **データ検証**
  - 抽出データの妥当性チェック
  - 欠損データの検出と警告
  - 異常値の検出（例：24 時間を超える勤務時間など）

### 2.3 自動入力機能

- **レコルへの自動ログイン**

  - 契約 ID、ログイン ID、パスワードを使用した認証
  - セッション管理

- **勤怠データ入力**
  - 抽出したデータをレコルのフォームに入力
  - 日付ごとの勤怠情報を順次入力
  - 入力結果の確認とエラーハンドリング

### 2.4 UI 機能

- **ファイル選択**

  - 画像ファイルまたは Excel ファイルの選択
  - ドラッグ&ドロップ対応（検討）

- **データプレビュー**

  - 抽出したデータの確認画面
  - 編集機能（必要に応じて）

- **実行ログ**
  - 処理状況の表示
  - エラーメッセージの表示
  - 入力結果のサマリー表示

## 3. 技術要件

### 3.1 使用技術（無料の AI フレームワーク・ライブラリ）

#### OCR（光学文字認識）

- **Tesseract OCR**

  - オープンソースの OCR エンジン
  - Python ラッパー：pytesseract
  - 無料で利用可能

- **EasyOCR**
  - ディープラーニングベースの OCR
  - 多言語対応（日本語含む）
  - 無料で利用可能

#### 画像処理

- **OpenCV**

  - 画像の前処理（ノイズ除去、コントラスト調整など）
  - 無料で利用可能

- **Pillow (PIL)**
  - 画像の読み込み・変換
  - 無料で利用可能

#### Excel 処理

- **pandas**

  - Excel ファイルの読み込み・データ処理
  - 無料で利用可能

- **openpyxl**
  - Excel ファイルの詳細な操作
  - 無料で利用可能

#### ブラウザ自動化

- **Selenium**

  - Web ブラウザの自動操作
  - レコルへの自動入力に使用
  - 無料で利用可能

- **Playwright**（代替案）
  - モダンなブラウザ自動化ツール
  - 無料で利用可能

#### その他

- **Python**

  - メインの開発言語
  - バージョン：3.8 以上推奨

- **GUI フレームワーク**（検討）
  - Tkinter（Python 標準ライブラリ）
  - PyQt5/PySide2（無料版）
  - Streamlit（Web ベース UI）

### 3.2 システム構成

```
[入力ファイル] → [データ抽出] → [データ検証] → [自動入力] → [レコル]
     ↓              ↓              ↓              ↓
  [画像/Excel]  [OCR/Excel解析]  [バリデーション]  [Selenium]
```

## 4. 非機能要件

### 4.1 パフォーマンス

- 画像 1 枚あたりの処理時間：30 秒以内（目安）
- Excel ファイル（1 ヶ月分）の処理時間：1 分以内（目安）

### 4.2 セキュリティ

- パスワードは暗号化して保存（オプション）
- 入力ファイルは処理後に削除可能（オプション）
- ログに機密情報を含めない

### 4.3 エラーハンドリング

- OCR 認識エラーの適切な処理
- ネットワークエラーの処理
- レコルの UI 変更への対応（柔軟なセレクター使用）

### 4.4 ユーザビリティ

- 直感的な操作画面
- 処理状況の可視化
- エラーメッセージの分かりやすい表示

## 5. 開発フェーズ

### フェーズ 1：基本機能の実装

- [x] 画像ファイルからの OCR 読み取り機能
  - ✅ EasyOCR と Tesseract OCR の両方に対応（`src/ocr_extractor.py`）
  - ✅ 画像前処理（ノイズ除去、コントラスト調整）実装済み
  - ✅ JPEG、PNG、PDF 形式に対応
  - ✅ 日付、出勤時刻、退勤時刻、休憩時間の抽出機能実装済み
- [x] Excel ファイルからのデータ読み取り機能
  - ✅ pandas/openpyxl を使用した実装（`src/excel_extractor.py`）
  - ✅ 列の自動検出機能実装済み
  - ✅ .xlsx、.xls 形式に対応
  - ✅ 日付、出勤時刻、退勤時刻、休憩時間の抽出機能実装済み
- [x] データ抽出・正規化機能
  - ✅ 日付形式の正規化（YYYY-MM-DD 形式）実装済み（`src/utils.py`）
  - ✅ 時刻形式の正規化（HH:MM 形式）実装済み
  - ✅ 様々な日付・時刻形式に対応（2024/01/01、2024 年 1 月 1 日、HH:MM、HH 時 MM 分など）
  - ✅ 勤務時間計算機能実装済み

### フェーズ 2：自動入力機能の実装

- [ ] レコルへの自動ログイン機能
- [ ] 勤怠データの自動入力機能
- [ ] エラーハンドリング

### フェーズ 3：UI 実装

- [ ] ファイル選択 UI
- [ ] データプレビュー機能
- [ ] 実行ログ表示

### フェーズ 4：テスト・改善

- [ ] 各種ファイル形式でのテスト
- [ ] エラーケースのテスト
- [ ] パフォーマンス最適化
- [ ] ユーザビリティ改善

## 6. 制約事項・注意点

### 6.1 技術的制約

- レコルの UI 変更により動作しなくなる可能性がある
- OCR の認識精度は画像の品質に依存する
- 手書き文字の認識精度は限定的な場合がある

### 6.2 法的・倫理的制約

- レコルの利用規約を遵守する必要がある
- 自動化ツールの使用が許可されているか確認が必要
- 個人情報の取り扱いに注意

### 6.3 運用上の注意

- 定期的な動作確認が必要
- エラー時の手動入力への切り替え手段を用意
- ログの確認と問題の早期発見

## 7. 今後の拡張案

- 複数ファイルの一括処理
- データの履歴管理
- 設定ファイルによるカスタマイズ
- 他の勤怠システムへの対応
- クラウドストレージ連携

## 8. 参考情報

- レコル：https://app.recoru.in/ap/home/
- Tesseract OCR：https://github.com/tesseract-ocr/tesseract
- EasyOCR：https://github.com/JaidedAI/EasyOCR
- Selenium：https://www.selenium.dev/
